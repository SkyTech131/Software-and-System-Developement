@startuml
title Sequence Diagram for Fingerprint-Based User Recognition with Detailed Logging and Limited Attempts

actor User
participant "RecognitionSystem" as RS
participant "FingerprintSensor" as FS
participant "Preprocessor" as PP
participant "FeatureExtractor" as FE
participant "NeuralNetworkModel" as NN
participant "Database" as DB
participant "Logger" as LG

User -> RS: Initiate authentication
RS -> LG: Log "Authentication started"

loop While (attempt count < MAX_ATTEMPTS)
  RS -> FS: Capture fingerprint
  FS -> RS: Return Fingerprint object
  RS -> LG: Log "Fingerprint captured"
  
  RS -> PP: Preprocess fingerprint image
  PP -> RS: Return enhanced image
  RS -> LG: Log "Image preprocessed"
  
  RS -> FE: Extract features from image
  FE -> RS: Return feature vector
  RS -> LG: Log "Features extracted"
  
  RS -> NN: Predict match (feature vector)
  NN -> RS: Return matching score
  RS -> LG: Log "Neural network returned score"
  
  RS -> DB: Query user by fingerprint (score)
  alt Match found
    DB -> RS: Return user profile
    RS -> LG: Log "User authenticated"
    RS -> User: Return authentication result (success)
    break
  else No match
    RS -> LG: Log "No match found"
    RS -> User: Prompt to retry
    RS -> LG: Log "Retry prompted"
  end
end

alt (attempt count >= MAX_ATTEMPTS and no match)
  RS -> LG: Log "Authentication failed: Maximum attempts reached"
  RS -> User: Return authentication failure
end

@enduml
